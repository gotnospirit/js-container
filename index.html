<!doctype html>
<html lang="fr">
<head>
<script type="text/javascript" src="container.js"></script>
<script type="text/javascript">
function ItemCounter(collection)
{
    this.countdown = function()
    {
        var i = 0,
            max = 0;

        if (collection instanceof Array)
        {
            max = collection.length;

            if (!max)
            {
                console.log('There is nothing to count :(');
            }
            else
            {
                console.log('There are ' + max + ' items to count:');

                for (; i < max; ++i)
                {
                    console.log('Item #' + i + ': ' + collection[i]);
                }
            }
        }
        else
        {
            console.log('Wrong argument type.');
        }
    };
}

ItemCounter.prototype.countdown = function()
{
    var data = this.data;

    if (data)
    {
        console.log('There are ' + data.length + ' items to count:');
        for (var i = 0; i < data.length; ++i)
        {
            console.log('Item #' + i + ': ' + data[i]);
        }
    }
};

function Lambda(name)
{
    this.name = name;
}

Lambda.prototype.hello = function()
{
    console.log('Hello ' + this.name);
};

function Printer(id)
{
    this.id = id;
}

function RequiredWorker(printer)
{
    this.execute = function()
    {
        console.log('I am connected with the <' + printer.id + '> printer');
    };
}

function OptionalWorker(printer)
{
    this.execute = function()
    {
        if (printer)
        {
            console.log('I am connected with the <' + printer.id + '> printer');
        }
        else
        {
            console.log('I am not connected to a printer');
        }
    };
}

function Rocket()
{
    this.ignited = false;
}

Rocket.prototype.ignition = function(launch_code)
{
    if (!this.ignited)
    {
        this.ignited = true;
        console.log('Ignition code <' + launch_code + '> accepted, engine started...');
    }
};

Rocket.prototype.launch = function()
{
    if (this.ignited)
    {
        console.log('Rocket launched!');
    }
};

function ItemFactory()
{
}

ItemFactory.prototype.createItem = function(name)
{
    return Object.create(Item).setup(name);
};

var Item = {
    setup: function(name)
    {
        this.name = name;
        return this;
    },

    identify: function()
    {
        console.log('I am item <' + this.name + '>');
    }
};

window.addEventListener('load', function() {
    var c = new Container();

    // -------------------------------------------------

    c
        .set('username', 'James')
        .set('password', 'azerty')
        .set('collection', [1, 5, 10]);

    // -------------------------------------------------

    c.register('wk1', RequiredWorker)
        .argument('@printer');

    c.register('wk2', OptionalWorker)
        .argument('@printer', false);
/*
    c.register('printer', Printer)
        .argument('abc-def-ghi');
*/
    c.register('lambda', Lambda)
        .argument('%username%:%password%');

    c.register('counter', ItemCounter)
        .argument('%collection%');

    c.register('rocket', Rocket)
        .method(Rocket.prototype.ignition, '%password%');

    c.register('mission', function Mission() {
        return {
            abort: function(target) {
                console.log('Mission to <' + target + '> aborted!');
            }
        };
    });

    c.register('item', ItemFactory.prototype.createItem)
        .argument('number 9');

    // -------------------------------------------------

    try {
        c.get('lambda')
            .hello();
    } catch(e) {
        console.log('Exception: ' + e.message);
    }

    try {
        c.get('wk1')
            .execute();
    } catch(e) {
        console.log('Exception: ' + e.message);
    }

    try {
        c.get('wk2')
            .execute();
    } catch(e) {
        console.log('Exception: ' + e.message);
    }

    try {
        c.get('rocket')
            .launch();
    } catch(e) {
        console.log('Exception: ' + e.message);
    }

    try {
        c.get('mission')
            .abort('Mars');
    } catch(e) {
        console.log('Exception: ' + e.message);
    }

    // c.destroy('mission');

    try {
        c.get('item')
            .identify();
    } catch(e) {
        console.log('Exception: ' + e.message);
    }

    try {
        c.get('counter')
            .countdown();
    } catch(e) {
        console.log('Exception: ' + e.message);
    }
});
</script>
</head>
<body>
</body>
</html>